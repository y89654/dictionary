<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>字典查询工具</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Consolas', '微软雅黑', sans-serif;
        }
        
        body {
            background-color: #0a1929;
            color: #00ff00;
            line-height: 1.6;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .container {
            background-color: #001e3c;
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.2);
        }
        
        h1, h2, h3 {
            color: #00ff00;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }
        
        h1 {
            font-size: 28px;
            border-bottom: 1px solid #00ff00;
            padding-bottom: 10px;
        }
        
        h2 {
            font-size: 22px;
        }
        
        .menu {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            background-color: #003366;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 12px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            border-radius: 3px;
        }
        
        .btn:hover {
            background-color: #004488;
            box-shadow: 0 0 8px rgba(0, 255, 0, 0.5);
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            background-color: #002244;
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 3px;
            font-size: 16px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: 'Consolas', monospace;
        }
        
        .result {
            background-color: #002244;
            border: 1px solid #00ff00;
            padding: 15px;
            margin: 15px 0;
            border-radius: 3px;
            min-height: 100px;
        }
        
        .word-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }
        
        .word-item {
            padding: 10px;
            border-bottom: 1px solid #003366;
        }
        
        .word-item:nth-child(even) {
            background-color: rgba(0, 50, 100, 0.3);
        }
        
        .hidden {
            display: none;
        }
        
        .status-bar {
            background-color: #002244;
            border: 1px solid #00ff00;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            text-align: center;
        }
        
        .back-btn {
            margin-top: 20px;
            background-color: #660000;
        }
        
        .back-btn:hover {
            background-color: #880000;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .action-buttons .btn {
            flex: 1;
        }
        
        .error {
            color: #ff5555;
            margin: 10px 0;
            text-align: center;
        }
        
        .success {
            color: #55ff55;
            margin: 10px 0;
            text-align: center;
        }
        
        .loading {
            color: #ffff55;
            margin: 10px 0;
            text-align: center;
        }
        
        .file-path {
            background-color: #002244;
            border: 1px solid #00ff00;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            text-align: center;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 主菜单 -->
        <div id="main-menu">
            <h1>字典查询工具</h1>
            
            <div class="file-path">
                字典文件路径: dictionary/dictionary.txt
            </div>
            
            <div id="file-status" class="status-bar">
                <span id="dict-count">正在加载字典...</span> | 
                <span id="drawn-count">已抽取: 0</span> | 
                <span id="wrong-count">错题: 0</span>
            </div>
            
            <div class="menu">
                <button class="btn" onclick="showSection('query-by-number')">1. 按序号查询单词</button>
                <button class="btn" onclick="showSection('show-all')">2. 显示全部单词</button>
                <button class="btn" onclick="showSection('random-draw')">3. 随机抽取单词</button>
                <button class="btn" onclick="resetDrawn()">4. 重置已抽取记录</button>
                <button class="btn" onclick="showSection('wrong-book-menu')">5. 错题本功能</button>
                <button class="btn" onclick="clearAllData()">6. 清空学习记录</button>
                <button class="btn" onclick="reloadDictionary()">7. 重新加载字典</button>
            </div>
        </div>
        
        <!-- 按序号查询 -->
        <div id="query-by-number" class="hidden">
            <h2>按序号查询</h2>
            <div class="input-group">
                <label for="query-number">请输入要查询的序号 (1-<span id="max-query-number">0</span>):</label>
                <input type="number" id="query-number" min="1" max="1000">
            </div>
            <button class="btn" onclick="queryByNumber()">查询</button>
            <div id="query-result" class="result"></div>
            <button class="btn back-btn" onclick="showSection('main-menu')">返回主菜单</button>
        </div>
        
        <!-- 显示全部单词 -->
        <div id="show-all" class="hidden">
            <h2>全部单词</h2>
            <div id="all-words" class="word-list"></div>
            <button class="btn back-btn" onclick="showSection('main-menu')">返回主菜单</button>
        </div>
        
        <!-- 随机抽取 -->
        <div id="random-draw" class="hidden">
            <h2>随机抽取单词</h2>
            <div id="random-word" class="result"></div>
            <div class="action-buttons">
                <button class="btn" onclick="showTranslation()">显示中文</button>
                <button class="btn" onclick="addToWrongBook()">加入错题本</button>
                <button class="btn" onclick="nextRandom()">下一个</button>
            </div>
            <button class="btn back-btn" onclick="showSection('main-menu')">返回主菜单</button>
        </div>
        
        <!-- 错题本菜单 -->
        <div id="wrong-book-menu" class="hidden">
            <h2>错题本功能</h2>
            <div class="status-bar">
                当前错题本共有 <span id="wrong-book-count">0</span> 个单词
            </div>
            <div class="menu">
                <button class="btn" onclick="showSection('wrong-book-test')">1. 错题本测试</button>
                <button class="btn" onclick="showWrongWords()">2. 查看所有错题</button>
                <button class="btn" onclick="showSection('edit-wrong-words')">3. 编辑错题</button>
                <button class="btn" onclick="clearWrongBook()">4. 清空错题本</button>
                <button class="btn" onclick="resetWrongTested()">5. 重置错题测试记录</button>
                <button class="btn back-btn" onclick="showSection('main-menu')">6. 返回主菜单</button>
            </div>
        </div>
        
        <!-- 错题本测试 -->
        <div id="wrong-book-test" class="hidden">
            <h2>错题本测试</h2>
            <div id="test-word" class="result"></div>
            <div class="action-buttons">
                <button class="btn" onclick="showTestTranslation()">显示中文</button>
                <button class="btn" onclick="removeFromWrongBook()">已掌握(移除)</button>
                <button class="btn" onclick="nextWrongTest()">下一个</button>
            </div>
            <button class="btn back-btn" onclick="showSection('wrong-book-menu')">返回错题本</button>
        </div>
        
        <!-- 查看所有错题 -->
        <div id="show-wrong-words" class="hidden">
            <h2>所有错题</h2>
            <div id="wrong-words-list" class="word-list"></div>
            <button class="btn back-btn" onclick="showSection('wrong-book-menu')">返回错题本</button>
        </div>
        
        <!-- 编辑错题 -->
        <div id="edit-wrong-words" class="hidden">
            <h2>编辑错题</h2>
            <div id="wrong-words-edit-list" class="word-list"></div>
            <div id="edit-form" class="hidden">
                <div class="input-group">
                    <label for="edit-english">英文:</label>
                    <input type="text" id="edit-english">
                </div>
                <div class="input-group">
                    <label for="edit-chinese">中文:</label>
                    <input type="text" id="edit-chinese">
                </div>
                <div class="action-buttons">
                    <button class="btn" onclick="saveEdit()">保存</button>
                    <button class="btn" onclick="cancelEdit()">取消</button>
                </div>
            </div>
            <button class="btn back-btn" onclick="showSection('wrong-book-menu')">返回错题本</button>
        </div>
    </div>

    <script>
        // 数据存储
        let dictionary = [];
        let drawnNumbers = [];
        let wrongBook = [];
        let wrongTested = [];
        
        // 当前状态
        let currentRandomIndex = -1;
        let currentWrongIndex = -1;
        let currentEditIndex = -1;
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            loadDictionaryFromFile();
        });
        
        // 从dictionary/dictionary.txt文件加载字典
        function loadDictionaryFromFile() {
            showMessage('正在从 dictionary/dictionary.txt 加载字典...', 'loading');
            
            // 尝试从不同可能的路径加载字典文件
            const possiblePaths = [
                'dictionary/dictionary.txt',
                './dictionary/dictionary.txt',
                '../dictionary/dictionary.txt',
                'dictionary.txt'
            ];
            
            let currentPathIndex = 0;
            
            function tryNextPath() {
                if (currentPathIndex >= possiblePaths.length) {
                    showMessage('无法加载字典文件，请检查文件路径', 'error');
                    return;
                }
                
                const path = possiblePaths[currentPathIndex];
                console.log(`尝试加载字典文件: ${path}`);
                
                fetch(path)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`无法加载 ${path}`);
                        }
                        return response.text();
                    })
                    .then(data => {
                        document.querySelector('.file-path').textContent = `字典文件路径: ${path}`;
                        parseDictionary(data);
                        showMessage(`字典加载成功 (${path})`, 'success');
                    })
                    .catch(error => {
                        console.error(`加载字典文件失败 (${path}):`, error);
                        currentPathIndex++;
                        setTimeout(tryNextPath, 100);
                    });
            }
            
            tryNextPath();
        }
        
        // 重新加载字典
        function reloadDictionary() {
            loadDictionaryFromFile();
        }
        
        // 解析字典内容
        function parseDictionary(content) {
            dictionary = [];
            const lines = content.split('\n');
            let validCount = 0;
            
            for (let line of lines) {
                line = line.trim();
                if (line) {
                    // 按第一个空格分割英文和中文
                    const firstSpaceIndex = line.indexOf(' ');
                    if (firstSpaceIndex > 0) {
                        const english = line.substring(0, firstSpaceIndex).trim();
                        const chinese = line.substring(firstSpaceIndex + 1).trim();
                        if (english && chinese) {
                            dictionary.push({ english, chinese });
                            validCount++;
                        }
                    }
                }
            }
            
            if (validCount > 0) {
                saveData();
                updateStatus();
            } else {
                showMessage('字典文件格式错误，请确保每行格式为"英文 中文"', 'error');
            }
        }
        
        // 显示/隐藏不同部分
        function showSection(sectionId) {
            // 隐藏所有部分
            const sections = document.querySelectorAll('.container > div');
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            
            // 显示指定部分
            document.getElementById(sectionId).classList.remove('hidden');
            
            // 更新相关数据
            if (sectionId === 'query-by-number') {
                document.getElementById('max-query-number').textContent = dictionary.length;
            } else if (sectionId === 'show-all') {
                showAllWords();
            } else if (sectionId === 'random-draw') {
                nextRandom();
            } else if (sectionId === 'wrong-book-menu') {
                updateWrongBookCount();
            } else if (sectionId === 'wrong-book-test') {
                nextWrongTest();
            } else if (sectionId === 'edit-wrong-words') {
                showEditWrongWords();
            }
        }
        
        // 按序号查询
        function queryByNumber() {
            const number = parseInt(document.getElementById('query-number').value);
            const resultDiv = document.getElementById('query-result');
            
            if (isNaN(number) || number < 1 || number > dictionary.length) {
                showMessage('请输入有效的序号', 'error', resultDiv);
                return;
            }
            
            const word = dictionary[number - 1];
            resultDiv.innerHTML = `
                <h3>查询结果</h3>
                <p><strong>序号:</strong> ${number}</p>
                <p><strong>英文:</strong> ${word.english}</p>
                <p><strong>中文:</strong> ${word.chinese}</p>
            `;
        }
        
        // 显示所有单词
        function showAllWords() {
            const allWordsDiv = document.getElementById('all-words');
            allWordsDiv.innerHTML = '';
            
            if (dictionary.length === 0) {
                allWordsDiv.innerHTML = '<p class="error">字典为空</p>';
                return;
            }
            
            dictionary.forEach((word, index) => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'word-item';
                wordDiv.innerHTML = `
                    <strong>${index + 1}.</strong> ${word.english} - ${word.chinese}
                `;
                allWordsDiv.appendChild(wordDiv);
            });
        }
        
        // 随机抽取单词
        function nextRandom() {
            if (dictionary.length === 0) {
                showMessage('字典为空', 'error', document.getElementById('random-word'));
                return;
            }
            
            // 如果所有单词都已抽取，提示重置
            if (drawnNumbers.length >= dictionary.length) {
                showMessage('所有单词都已抽取，请重置抽取记录', 'error', document.getElementById('random-word'));
                return;
            }
            
            // 生成随机数，排除已抽取的
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * dictionary.length);
            } while (drawnNumbers.includes(randomIndex));
            
            currentRandomIndex = randomIndex;
            const word = dictionary[randomIndex];
            
            document.getElementById('random-word').innerHTML = `
                <h3>随机抽取的单词</h3>
                <p><strong>英文:</strong> ${word.english}</p>
                <p><strong>中文:</strong> <span id="random-chinese" class="hidden">${word.chinese}</span></p>
            `;
            
            // 记录已抽取
            if (!drawnNumbers.includes(randomIndex)) {
                drawnNumbers.push(randomIndex);
                saveData();
                updateStatus();
            }
        }
        
        // 显示翻译
        function showTranslation() {
            document.getElementById('random-chinese').classList.remove('hidden');
        }
        
        // 添加到错题本
        function addToWrongBook() {
            if (currentRandomIndex === -1) return;
            
            const word = dictionary[currentRandomIndex];
            
            // 检查是否已在错题本中
            const alreadyExists = wrongBook.some(item => 
                item.english === word.english && item.chinese === word.chinese
            );
            
            if (!alreadyExists) {
                wrongBook.push({
                    english: word.english,
                    chinese: word.chinese,
                    originalIndex: currentRandomIndex
                });
                saveData();
                updateStatus();
                showMessage('已添加到错题本', 'success', document.getElementById('random-word'));
            } else {
                showMessage('该单词已在错题本中', 'error', document.getElementById('random-word'));
            }
        }
        
        // 重置已抽取记录
        function resetDrawn() {
            if (confirm('确定要重置所有已抽取记录吗？')) {
                drawnNumbers = [];
                saveData();
                updateStatus();
                showMessage('已重置所有抽取记录', 'success');
            }
        }
        
        // 错题本功能
        function updateWrongBookCount() {
            document.getElementById('wrong-book-count').textContent = wrongBook.length;
        }
        
        // 错题本测试
        function nextWrongTest() {
            if (wrongBook.length === 0) {
                showMessage('错题本为空', 'error', document.getElementById('test-word'));
                return;
            }
            
            // 如果所有错题都已测试，提示重置
            if (wrongTested.length >= wrongBook.length) {
                if (confirm('所有错题都已测试，是否重置测试记录？')) {
                    resetWrongTested();
                } else {
                    showSection('wrong-book-menu');
                    return;
                }
            }
            
            // 生成随机数，排除已测试的
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * wrongBook.length);
            } while (wrongTested.includes(randomIndex));
            
            currentWrongIndex = randomIndex;
            const word = wrongBook[randomIndex];
            
            document.getElementById('test-word').innerHTML = `
                <h3>测试单词</h3>
                <p><strong>英文:</strong> ${word.english}</p>
                <p><strong>中文:</strong> <span id="test-chinese" class="hidden">${word.chinese}</span></p>
            `;
            
            // 记录已测试
            if (!wrongTested.includes(randomIndex)) {
                wrongTested.push(randomIndex);
                saveData();
            }
        }
        
        // 显示测试翻译
        function showTestTranslation() {
            document.getElementById('test-chinese').classList.remove('hidden');
        }
        
        // 从错题本移除
        function removeFromWrongBook() {
            if (currentWrongIndex === -1 || wrongBook.length === 0) return;
            
            wrongBook.splice(currentWrongIndex, 1);
            
            // 更新测试记录
            wrongTested = wrongTested.filter(index => index !== currentWrongIndex);
            // 调整大于当前索引的记录
            wrongTested = wrongTested.map(index => index > currentWrongIndex ? index - 1 : index);
            
            saveData();
            updateStatus();
            
            showMessage('该单词已从错题本移除', 'success', document.getElementById('test-word'));
            
            // 继续下一个测试
            setTimeout(() => {
                nextWrongTest();
            }, 1000);
        }
        
        // 显示所有错题
        function showWrongWords() {
            const wrongWordsListDiv = document.getElementById('wrong-words-list');
            wrongWordsListDiv.innerHTML = '';
            
            if (wrongBook.length === 0) {
                wrongWordsListDiv.innerHTML = '<p class="error">错题本为空</p>';
                return;
            }
            
            wrongBook.forEach((word, index) => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'word-item';
                wordDiv.innerHTML = `
                    <strong>${index + 1}.</strong> ${word.english} - ${word.chinese}
                    <br><small>原序号: ${word.originalIndex + 1}</small>
                `;
                wrongWordsListDiv.appendChild(wordDiv);
            });
            
            showSection('show-wrong-words');
        }
        
        // 显示编辑错题界面
        function showEditWrongWords() {
            const editListDiv = document.getElementById('wrong-words-edit-list');
            editListDiv.innerHTML = '';
            
            if (wrongBook.length === 0) {
                editListDiv.innerHTML = '<p class="error">错题本为空，无法编辑</p>';
                return;
            }
            
            wrongBook.forEach((word, index) => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'word-item';
                wordDiv.innerHTML = `
                    <strong>${index + 1}.</strong> ${word.english} - ${word.chinese}
                    <button class="btn" onclick="startEdit(${index})" style="float:right; padding:5px 10px; font-size:12px;">编辑</button>
                `;
                editListDiv.appendChild(wordDiv);
            });
        }
        
        // 开始编辑错题
        function startEdit(index) {
            currentEditIndex = index;
            const word = wrongBook[index];
            
            document.getElementById('edit-english').value = word.english;
            document.getElementById('edit-chinese').value = word.chinese;
            
            document.getElementById('edit-form').classList.remove('hidden');
        }
        
        // 保存编辑
        function saveEdit() {
            if (currentEditIndex === -1) return;
            
            const english = document.getElementById('edit-english').value.trim();
            const chinese = document.getElementById('edit-chinese').value.trim();
            
            if (!english || !chinese) {
                showMessage('英文和中文都不能为空', 'error');
                return;
            }
            
            wrongBook[currentEditIndex] = {
                ...wrongBook[currentEditIndex],
                english,
                chinese
            };
            
            saveData();
            showMessage('错题更新成功', 'success');
            
            cancelEdit();
            showEditWrongWords();
        }
        
        // 取消编辑
        function cancelEdit() {
            document.getElementById('edit-form').classList.add('hidden');
            currentEditIndex = -1;
        }
        
        // 清空错题本
        function clearWrongBook() {
            if (wrongBook.length === 0) {
                showMessage('错题本已为空', 'error');
                return;
            }
            
            if (confirm('确定要清空错题本吗？此操作不可撤销！')) {
                wrongBook = [];
                wrongTested = [];
                saveData();
                updateStatus();
                showMessage('错题本已清空', 'success');
            }
        }
        
        // 重置错题测试记录
        function resetWrongTested() {
            wrongTested = [];
            saveData();
            showMessage('已重置错题测试记录', 'success');
        }
        
        // 清空所有数据
        function clearAllData() {
            if (confirm('确定要清空所有学习记录吗？包括抽取记录和错题本？此操作不可撤销！')) {
                drawnNumbers = [];
                wrongBook = [];
                wrongTested = [];
                saveData();
                updateStatus();
                showMessage('所有学习记录已清空', 'success');
            }
        }
        
        // 显示消息
        function showMessage(message, type, container = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error' : (type === 'loading' ? 'loading' : 'success');
            messageDiv.textContent = message;
            
            if (container) {
                container.appendChild(messageDiv);
                setTimeout(() => {
                    messageDiv.remove();
                }, 3000);
            } else {
                // 在主菜单显示消息
                const mainMenu = document.getElementById('main-menu');
                mainMenu.appendChild(messageDiv);
                setTimeout(() => {
                    messageDiv.remove();
                }, 3000);
            }
        }
        
        // 更新状态栏
        function updateStatus() {
            document.getElementById('dict-count').textContent = 
                dictionary.length > 0 ? `字典: ${dictionary.length} 个单词` : '字典加载失败';
            document.getElementById('drawn-count').textContent = `已抽取: ${drawnNumbers.length}`;
            document.getElementById('wrong-count').textContent = `错题: ${wrongBook.length}`;
        }
        
        // 保存数据到localStorage
        function saveData() {
            localStorage.setItem('dictionary', JSON.stringify(dictionary));
            localStorage.setItem('drawnNumbers', JSON.stringify(drawnNumbers));
            localStorage.setItem('wrongBook', JSON.stringify(wrongBook));
            localStorage.setItem('wrongTested', JSON.stringify(wrongTested));
        }
        
        // 从localStorage加载数据
        function loadData() {
            const savedDictionary = localStorage.getItem('dictionary');
            const savedDrawnNumbers = localStorage.getItem('drawnNumbers');
            const savedWrongBook = localStorage.getItem('wrongBook');
            const savedWrongTested = localStorage.getItem('wrongTested');
            
            if (savedDictionary) dictionary = JSON.parse(savedDictionary);
            if (savedDrawnNumbers) drawnNumbers = JSON.parse(savedDrawnNumbers);
            if (savedWrongBook) wrongBook = JSON.parse(savedWrongBook);
            if (savedWrongTested) wrongTested = JSON.parse(savedWrongTested);
            
            updateStatus();
        }
    </script>
</body>
</html>